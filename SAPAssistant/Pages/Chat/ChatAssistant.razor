@page "/chat-assistant"
@layout ChatLayout
@using Microsoft.AspNetCore.Components.Web

<div class="chat-content-full">
    <div class="messages" @ref="messagesContainer">
        @foreach (var msg in Messages)
        {
            <ChatMessage Content="@msg.Content" IsUser="@msg.IsUser" />
        }
    </div>

    <div class="input-area">
        <input @bind="UserInput"
               @bind:event="oninput"
               @onkeypress="HandleKeyPress"
               placeholder="Escribe un mensaje..." />

        <button @onclick="SendMessage">Enviar</button>
    </div>
</div>

<link href="css/chatassistant.css" rel="stylesheet" />
<link href="css/chatmessage.css" rel="stylesheet" />

@code {
    private string UserInput { get; set; } = string.Empty;
    private List<Message> Messages { get; set; } = new();

    private ElementReference messagesContainer;

    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(UserInput)) return;

        Messages.Add(new Message { Content = UserInput, IsUser = true });
        var userMessage = UserInput;
        UserInput = "";

        await Task.Delay(500);
        Messages.Add(new Message
            {
                Content = $"Respuesta automática a: '{userMessage}'",
                IsUser = false
            });

        await ScrollToBottom();
    }

    private async Task ScrollToBottom()
    {
        await Task.Delay(100);
        await messagesContainer.FocusAsync();
    }

    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SendMessage();
        }
    }

    public class Message
    {
        public string Content { get; set; } = string.Empty;
        public bool IsUser { get; set; }
    }
}
