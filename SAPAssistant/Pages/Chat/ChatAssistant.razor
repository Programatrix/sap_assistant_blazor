@page "/chat-assistant"
@using System.Timers

<div class="chat-container">
    <div class="sidebar">
        <h3>Asistente</h3>
        <ul>
            <li @onclick="@(() => LoadTopic("General"))">General</li>
            <li @onclick="@(() => LoadTopic("Proyectos"))">Proyectos</li>
            <li @onclick="@(() => LoadTopic("Consultas SQL"))">Consultas SQL</li>
        </ul>
    </div>

    <div class="chat-area">
        <div class="messages" @ref="messagesContainer">
            @foreach (var msg in Messages)
            {
                <ChatMessage Content="@msg.Content" IsUser="@msg.IsUser" />
            }
        </div>

        <div class="input-area">
            <input @bind="UserInput" @bind:event="oninput" @onkeypress="HandleKeyPress" placeholder="Escribe un mensaje..." />
            <button @onclick="SendMessage">Enviar</button>
        </div>
    </div>
</div>

@code {
    private string UserInput { get; set; } = "";
    private List<Message> Messages { get; set; } = new();

    private ElementReference messagesContainer;

    private void LoadTopic(string topic)
    {
        Messages.Clear();
        Messages.Add(new Message { Content = $"Has seleccionado la categoría: {topic}. ¿Cómo puedo ayudarte?", IsUser = false });
    }

    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(UserInput)) return;

        Messages.Add(new Message { Content = UserInput, IsUser = true });
        var userMessage = UserInput;
        UserInput = "";

        // Simulando respuesta del asistente
        await Task.Delay(500);
        Messages.Add(new Message { Content = $"Respuesta automática a: '{userMessage}'", IsUser = false });

        await ScrollToBottom();
    }

    private async Task ScrollToBottom()
    {
        await Task.Delay(100);
        await messagesContainer.FocusAsync();
    }

    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SendMessage();
        }
    }

    public class Message
    {
        public string Content { get; set; }
        public bool IsUser { get; set; }
    }
}
