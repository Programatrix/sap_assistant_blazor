<link href="css/chathistory.css" rel="stylesheet" />

<div class="chat-history">
    <button @onclick="NewChat">+ Nuevo Chat</button>

    <ul>
        @foreach (var chat in Chats)
        {
            <li class="@(chat.Id == ActiveChatId ? "active" : "")"
                @onclick="@(() => SelectChat(chat.Id))">
                @chat.Title
            </li>
        }
    </ul>
</div>

@code {
    [Parameter] public EventCallback<string> OnChatSelected { get; set; }

    private List<ChatItem> Chats = new()
    {
        new ChatItem { Id = "1", Title = "Chat de Prueba 1" },
        new ChatItem { Id = "2", Title = "Consulta Proyecto X" },
        new ChatItem { Id = "3", Title = "SQL Optimización" }
    };

    private string ActiveChatId = "1"; // Por defecto el primero activo

    private async Task SelectChat(string id)
    {
        ActiveChatId = id;
        if (OnChatSelected.HasDelegate)
            await OnChatSelected.InvokeAsync(id);
    }

    private void NewChat()
    {
        var newId = (Chats.Count + 1).ToString();
        Chats.Add(new ChatItem { Id = newId, Title = $"Nuevo Chat {newId}" });
        SelectChat(newId); // Activamos automáticamente el nuevo chat
    }

    public class ChatItem
    {
        public string Id { get; set; }
        public string Title { get; set; }
    }
}
