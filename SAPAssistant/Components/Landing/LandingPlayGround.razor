@page "/playground"

<section id="playground" class="d-flex justify-content-center align-items-center py-5" style="min-height:100vh;">
    <div class="card-chat text-center">
        <h2 class="fw-bold mb-2">Prueba el Asistente SAP B1</h2>
        <p class="mb-4 text-muted">
            Hazle una consulta a nuestro asistente y descubre cómo puede ayudarte.
        </p>

        <!-- Contenedor del chat -->
        <div class="chat-container border rounded p-3 mb-3" @ref="chatBox">
            @foreach (var msg in Messages)
            {
                <div class="chat-bubble @(msg.IsUser ? "user" : "bot")">
                    @msg.Text
                </div>
            }
        </div>

        <!-- Input y botón -->
        <div class="input-group">
            <input @bind="UserMessage" @bind:event="oninput"
                   @onkeydown="HandleEnter"
                   type="text" class="form-control"
                   placeholder="Escribe tu consulta aquí..." />
            <button class="btn btn-primary" @onclick="SendMessage">Enviar</button>
        </div>
    </div>
</section>

@code {
    private string UserMessage { get; set; } = "";
    private List<Message> Messages { get; set; } = new()
    {
        new Message { Text = "👋 ¡Hola! ¿Sobre qué datos de tu negocio quieres información?", IsUser = false }
    };

    private ElementReference chatBox;

    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(UserMessage)) return;

        Messages.Add(new Message { Text = UserMessage, IsUser = true });
        var userText = UserMessage;
        UserMessage = "";

        await ScrollToBottom();

        // Simulación de respuesta
        await Task.Delay(1000);
        Messages.Add(new Message { Text = "Procesando tu solicitud... 📊", IsUser = false });
        await ScrollToBottom();
    }

    private async Task ScrollToBottom()
    {
        await Task.Yield();
        // Aquí puedes agregar JS Interop si quieres auto-scroll completo
    }

    private void HandleEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
            SendMessage();
    }

    public class Message
    {
        public string Text { get; set; }
        public bool IsUser { get; set; }
    }
}

