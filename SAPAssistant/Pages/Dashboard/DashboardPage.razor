@page "/dashboard"
@using SAPAssistant.Service
@using SAPAssistant.Models
@using SAPAssistant.ViewModels
@attribute [Authorize]
@layout AssistantLayout

@inject DashboardPageViewModel VM

<h1>📊 Mi Cockpit Inteligente</h1>

<div class="dashboard-actions">
    <button class="btn-global-refresh" @onclick="VM.RefreshAll">🔄 Actualizar Todo</button>
    <button class="btn-create-kpi" @onclick="VM.OpenWizard">✨ Crear Nuevo KPI</button>
    <button class="btn-edit-dashboard" @onclick="VM.EditDashboard">🛠️ Editar Dashboard</button>
</div>

@if (VM.IsWizardOpen)
{
    <DashboardWizard OnFinished="VM.CloseWizard" />
}
else
{
    @if (VM.DashboardService.KPIs.Count == 0)
    {
        <DashboardEmptyState OnCreateKPI="VM.OpenWizard" />
    }
    else
    {
        <div class="dashboard-grid">
            @foreach (var card in VM.DashboardService.KPIs)
            {
                <DashboardCardWrapper Card="card" />
            }
        </div>
    }
}

